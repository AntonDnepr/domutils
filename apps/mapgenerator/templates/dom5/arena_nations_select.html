{% extends "base.html" %}

{% block main_content %}
<div class="container mt-5">
  <div class="text-center">
    <h2 class="display-4 mb-4">Select nations</h2>
  </div>
  <div class="row">
    <div class="mb-4">
          <p class="lead">Select nations that will be used in map generation.</p>
          <p>There is no validation that nations are selected from the same Age. You should select at least 2
            nations from the same Age for the game to not declare you a winner immediately.</p>
          <p>There is no validation for land/water nation, so please be careful when selecting them.</p>
    </div>
  </div>
  <div class="row">
    <form id="selectedMods">
      <div class="mb-4">
        <p>Select mods if you need any:</p>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="de" name="mods" id="DominionsEnhanced">
          <label class="form-check-label" for="DominionsEnhanced">
            DominionsEnhanced
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="debug" name="mods" id="DebugMod">
          <label class="form-check-label" for="DebugMod">
            DebugMod
          </label>
        </div>
      </div>
    </form>
    <form class="mb-3">
      <h3>Land nations</h3>
      <div class="mb-3 parent-js">
        <label for="landNation1" class="form-label">Land Nation 1</label>
        <input type="text" class="form-control" id="landNation1" name="search_term" data-id="landNation1"
          hx-trigger="keyup changed delay:500ms" hx-target="#landNation1Results" placeholder="Search..."
          hx-include="#selectedMods" hx-get="/dom5/autocomplete/nations/">
        <div id="landNation1Results" class="mt-2">

        </div>
      </div>
      <div class="mb-3 parent-js">
        <label for="landNation2" class="form-label">Land Nation 2</label>
        <input type="text" class="form-control" id="landNation2" name="search_term" data-id="landNation2"
          hx-trigger="keyup changed delay:500ms" hx-target="#landNation2Results" placeholder="Search..."
          hx-include="#selectedMods" hx-get="/dom5/autocomplete/nations/">
        <div id="landNation2Results" class="mt-2">

        </div>
      </div>
      <h3>Underwater nations</h3>
      <div class="mb-3 parent-js">
        <label for="underwaterNation1" class="form-label">Underwater Nation 1</label>
        <input type="text" class="form-control" id="underwaterNation1" name="search_term" data-id="underwaterNation1"
        hx-trigger="keyup changed delay:500ms" hx-target="#underwaterNation1Results" placeholder="Search..."
        hx-include="#selectedMods" hx-get="/dom5/autocomplete/nations/">
        <div id="underwaterNation1Results" class="mt-2">

        </div>
      </div>
      <div class="mb-3 parent-js">
        <label for="underwaterNation2" class="form-label">Underwater Nation 2</label>
        <input type="text" class="form-control" id="underwaterNation2" name="search_term" data-id="underwaterNation2"
        hx-trigger="keyup changed delay:500ms" hx-target="#underwaterNation2Results" placeholder="Search..."
        hx-include="#selectedMods" hx-get="/dom5/autocomplete/nations/">
        <div id="underwaterNation2Results" class="mt-2">

        </div>
      </div>
      <button type="submit" class="btn btn-primary" disabled>Proceed to Next Step</button>
    </form>
  </div>
</div>
{% endblock main_content %}

{% block extra_js %}
<script src="https://unpkg.com/htmx.org@1.9.9"></script>
<script>
  htmx.onLoad(function(content) {
    var selectableRows = content.querySelectorAll(".selectable-js");
    for (var i = 0; i < selectableRows.length; i++) {
        var selectable = selectableRows[i];
        selectable.onclick = function() {
          var parentDiv = this.closest('.parent-js');
          var targetInput = parentDiv.querySelector('input');
          if (targetInput) {
              var dataValue = this.getAttribute('data-name');
              targetInput.value = dataValue;
              var targetTable = parentDiv.querySelector('.table-responsive');
              targetTable.innerHTML = "";
          } else {
              console.error('Input not found.');
          }
        };

    }
  });
</script>
{% endblock extra_js %}